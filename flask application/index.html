<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Camera App</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/webcamjs/1.0.26/webcam.min.js"></script>
</head>
<body>
    <h1>Camera App</h1>
    <div id="camera-container">
        <video id="camera" autoplay playsinline></video>
    </div>
    <script>
        // Wait for Webcam.js to finish loading
        window.onload = function () {
            // Initialize webcam
            Webcam.set({
                width: 640,
                height: 480,
                dest_width: 640,
                dest_height: 480,
                image_format: 'jpeg',
                jpeg_quality: 90,
                flip_horiz: true // Adjust as needed
            });
            Webcam.attach('#camera');

            // Function to capture image and upload
            function captureAndUpload() {
                // Capture image from webcam
                Webcam.snap(function (data_uri) {
                    // Get current location
                    navigator.geolocation.getCurrentPosition(function (position) {
                        let latitude = position.coords.latitude;
                        let longitude = position.coords.longitude;

                        // Send captured image and location data to Flask server
                        fetch('/upload', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                imageData: data_uri,
                                latitude: latitude,
                                longitude: longitude,
                                imageUrl: document.getElementById('captured-image').src
                            }),
                        })
                            .then(response => response.json())
                            .then(data => {
                                console.log(data);
                            })
                            .catch(error => {
                                console.error('Error:', error);
                            });
                    });
                });
            }

            // Call captureAndUpload function once the page is loaded
            captureAndUpload();
            // Call captureAndUpload function every 5 seconds
            setInterval(captureAndUpload, 5000);
        };
    </script>
</body>
</html>
